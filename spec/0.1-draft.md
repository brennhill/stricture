<!--
SPDX-FileCopyrightText: 2026 Brenn Hill
SPDX-License-Identifier: CC-BY-4.0
-->

# Stricture Open Standard (SOS) v0.1 (Draft)

Status: Draft
Version: 0.1.0-draft
Last Updated: 2026-02-14

## 1. Introduction

This standard defines an interoperable model for:

1. Field-level API lineage.
2. Architecture invariants.
3. Deterministic drift classification.
4. Release policy outcomes (warn/block/override).
5. Overlay mappings to existing standards.

The objective is safe, high-velocity software delivery across multi-repo,
multi-system environments without redundant metadata definitions.

## 2. Conformance Language

The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", and "MAY" are to be
interpreted as described in RFC 2119 and RFC 8174.

## 3. Core Concepts

### 3.1 System

A `system` is a producer or transformer of data. Systems may be:

1. Internal (same repository boundary).
2. Cross-repository internal.
3. External third-party provider.

Each system SHOULD have a stable identifier.

### 3.1.1 Hierarchical System IDs (No Extra Annotation Keys)

Implementations MUST support hierarchical system IDs using a single optional
`:` separator:

1. `topology_id` (ecosystem node): `location-tracking-service`
2. `subsystem_id` (internal node): `location-tracking-service:tracking-api`

Rules:

1. Full system IDs MUST remain unique.
2. The `topology_id` is the prefix before the first `:`.
3. The `subsystem_id` is the suffix after the first `:`.
4. If no `:` is present, the system is top-level only.
5. No additional annotation key is required for hierarchy.

This convention applies consistently to `source_system`, source
`upstream_system`, and `systems[].id`.

### 3.2 Field Identity

A `field_id` is a stable, immutable identity for an externally relevant output
field. A `field` path is the current structural location. Structural location MAY
change while `field_id` remains stable.

### 3.3 Source Provenance

Each output field MUST declare one or more provenance sources. Sources MAY include
transformation metadata (normalize, aggregate, derive, join, and similar).

### 3.4 Invariant

An invariant is a property that MUST hold across releases. Example categories:

1. Dependency direction.
2. Provenance completeness.
3. Regulated flow constraints.
4. Version compatibility.
5. Escalation coverage.

### 3.5 Drift Event

A drift event is a semantically relevant delta between baseline and head
artifacts. Drift events MUST be classified deterministically.

## 4. Canonical Field Annotation Model

Each externally relevant output field MUST support these canonical properties:

1. `annotation_schema_version`
2. `field_id`
3. `field`
4. `source_system`
5. `source_version`
6. `min_supported_source_version`
7. `transform_type`
8. `merge_strategy`
9. `break_policy`
10. `confidence`
11. `data_classification`
12. `owner`
13. `escalation`
14. `contract_test_id`
15. `introduced_at`
16. `sources`
17. `flow`
18. `note`

Optional:

1. `renamed_from`
2. `sunset_at`

### 4.1 Authoring-Minimal Keys

To reduce annotation verbosity, implementations MUST accept a compact authoring
form with this minimum:

1. `field` or `field_id`
2. `source_system`
3. `source_version`
4. `sources`

All other canonical properties MAY be omitted in source comments and filled by
deterministic defaults during normalization.

### 4.2 Normalization Defaults

When omitted, implementations SHOULD apply these defaults:

1. `annotation_schema_version`: `1`
2. `field_id`: derived from `field` (`.` / `-` / `[` / `]` -> `_`)
3. `field`: derived from `field_id` (`_` -> `.`) when not explicitly provided
4. `min_supported_source_version`: same as `source_version`
5. `transform_type`: `passthrough`
6. `merge_strategy`: `single_source` for one source, `priority` for multiple
7. `break_policy`: `strict`
8. `confidence`: `declared`
9. `data_classification`: `internal`
10. `owner`: `team.<source_system_slug>`
11. `escalation`: `slack:#<source_system_slug>-oncall`
12. `contract_test_id`: `ci://contracts/<source_system_slug>/<field_id>`
13. `introduced_at`: `1970-01-01`
14. `flow`: `from @<source_system> mapped @self`
15. `note`: `defaulted_by=stricture`

Normalized artifacts SHOULD emit explicit canonical values (including defaults)
to preserve deterministic diffs and profile exports.

### 4.3 Accepted Synonyms

Implementations MAY accept synonyms to support migration. If canonical and synonym
are both present with conflicting values, parsing MUST fail.

Examples:

1. `field_path` -> `field`
2. `service_name` -> `source_system`
3. `service_version` -> `source_version`
4. `owner_team` -> `owner`

## 5. Source Reference Grammar

A source entry follows:

`kind:target#path[@scope[!as_of]][?contract_ref=<ref>[&provider_id=<id>][&upstream_system=<id>]]`

Valid `kind` values SHOULD include:

1. `api`
2. `input`
3. `db`
4. `event`
5. `file`
6. `cache`

Valid `scope` values:

1. `internal`
2. `cross_repo`
3. `external`

Normative rules:

1. `contract_ref` MUST be present.
2. `provider_id` MUST be present for `external` sources.
3. `as_of` MUST be present for `external` sources.
4. `provider_id` MUST NOT be set for non-external sources.

## 6. Artifact Model

A conformance artifact MUST support these top-level sections:

1. `metadata`
2. `systems`
3. `fields`
4. `edges`
5. `invariants`
6. `findings`
7. `overrides`

System IDs in `systems`, `fields[].source_system`, and `edges` MUST use the same
canonical identifier space, including optional hierarchical IDs from ยง3.1.1.

`metadata` SHOULD include:

1. spec version
2. generator identifier
3. generated timestamp
4. profile

## 7. Deterministic Evaluation Semantics

### 7.1 Ordering

Given identical input, output ordering MUST be deterministic.

Findings MUST be sorted by:

1. severity rank
2. rule/category ID
3. file path or system ID
4. line and column when present
5. field_id

### 7.2 Drift Classes

Implementations SHOULD classify drift at least into:

1. `field_removed`
2. `field_added`
3. `type_changed`
4. `enum_changed`
5. `source_version_changed`
6. `source_removed`
7. `classification_relaxed`
8. `annotation_missing`
9. `external_as_of_stale`
10. `invariant_violation`

### 7.3 Severity

A minimum severity lattice is:

1. `info`
2. `low`
3. `medium`
4. `high`

Severity mapping MUST be deterministic and documented.

## 8. Policy Modes

Supported policy modes:

1. `warn`
2. `block`

Normative behavior:

1. `warn` mode MUST report findings and SHOULD return successful status.
2. `block` mode MUST return failure when effective severity meets threshold and
   no active override applies.

## 9. Override Semantics

An override MUST include:

1. `field_id`
2. `change_type` or wildcard
3. `expires`
4. `reason`

Optional:

1. `ticket`
2. `owner`

Normative rules:

1. Expired overrides MUST NOT suppress findings.
2. Override matching MUST be deterministic.
3. Suppressed findings SHOULD remain visible as overridden for auditability.

## 10. Architecture Invariants

Invariant declarations MUST include:

1. `id`
2. `kind`
3. `applies_to`
4. `assert`
5. `severity`
6. `mode`

Implementations SHOULD support at least these invariant kinds:

1. dependency direction
2. provenance required
3. source-version compatibility
4. regulated flow controls
5. escalation coverage

## 11. Profiles and Overlays

The Stricture Open Standard (SOS) overlays external standards instead of replacing them.

A profile exporter/importer MUST preserve semantic equivalence between canonical
fields and profile aliases.

Initial profile set:

1. `stricture` (canonical)
2. `openapi`
3. `asyncapi`
4. `opentelemetry`
5. `openlineage`

Profile requirements:

1. Canonical lossless round-trip SHOULD be supported where feasible.
2. Non-lossless mappings MUST document known gaps.

## 12. Conformance Test Suite

A conformant implementation MUST pass a shared fixture suite covering:

1. parsing and canonical normalization
2. synonym conflict failures
3. deterministic finding ordering
4. drift class and severity expectations
5. override expiry behavior
6. profile mapping parity
7. invariant evaluation outcomes

Conformance levels:

1. Core
2. Core plus profiles
3. Experimental extensions

## 13. Security and Compliance Considerations

1. Sensitive field classifications SHOULD be validated against configured policy.
2. External provider metadata SHOULD include as-of dates for change visibility.
3. Findings SHOULD be producible in machine-readable formats for CI and governance
   systems.

## 14. Reference Example

```yaml
metadata:
  spec_version: 0.1.0-draft
  profile: stricture
  generated_at: 2026-02-14T00:00:00Z
systems:
  - id: payments-core
    kind: internal
  - id: location-tracking-service:tracking-api
    kind: internal
  - id: spotify
    kind: external
fields:
  - field_id: response_payment_status
    field: response.payment.status
    source_system: payments-core
    source_version: 2026.02
    min_supported_source_version: 2026.01
    transform_type: normalize
    merge_strategy: single_source
    break_policy: strict
    data_classification: sensitive
    owner: team.payments
    escalation: pagerduty:payments
    sources:
      - api:payments.GetPayment#response.status@cross_repo?contract_ref=git+https://example.com/payments/openapi.yaml@abc
    flow: from @payments-core enriched @self
    note: normalized by PaymentStatusMapper
invariants:
  - id: ARC-DEP-001
    kind: dependency_direction
    applies_to: [service]
    assert: edge -> domain -> data
    severity: high
    mode: block
```

## 15. Open Issues for v0.1

1. Final severity mapping for all drift classes.
2. Canonical machine schema publication path.
3. Formalization of wildcard override match precedence.
4. Profile round-trip guarantees per external standard.

## 16. Path to v1.0

Criteria:

1. Conformance fixtures stabilized across two release cycles.
2. At least one independent implementation passes core conformance.
3. Profile mapping behavior documented and interoperable.

## 17. References

1. OpenAPI Specification: https://www.openapis.org/
2. AsyncAPI: https://www.asyncapi.com/docs
3. OpenTelemetry: https://opentelemetry.io/docs/
4. OpenLineage: https://openlineage.io/docs/
5. RFC 2119: https://www.rfc-editor.org/rfc/rfc2119
6. RFC 8174: https://www.rfc-editor.org/rfc/rfc8174
