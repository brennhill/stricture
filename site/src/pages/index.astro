---
import MainLayout from "../layouts/MainLayout.astro";

export const prerender = true;

const heroSlides = [
  {
    title: "Build safe with AI.",
    lead: "AI-generated code can drift APIs without warning. Stricture catches the drift, shows impact, and blocks unsafe deploys before customers feel it.",
    visualTitle: "Agent change introduces contract drift",
    visualBody: "A generated PR widens a core field type. Stricture traces downstream consumers, highlights the impacted path, and blocks the deploy until contracts are fixed."
  },
  {
    title: "Keep AI-generated changes inside enforceable guardrails.",
    lead: "Define acceptable changes with annotations, ownership, flow tiers, and policy gates so teams move fast without breaking contracts.",
    visualTitle: "Policy mode protects release flow",
    visualBody: "Teams run in warn mode first, then promote rules to block mode and flow-tier hard blocks once confidence is high and owners are assigned."
  },
  {
    title: "Detect API drift before it becomes an incident.",
    lead: "Compare lineage against a known-good baseline to see what changed, why it matters, and who is affected.",
    visualTitle: "Baseline diff catches risky changes",
    visualBody: "Findings include the source change, blast radius, and escalation chain so responders can act before customers are impacted."
  },
  {
    title: "Ship faster without losing contract integrity.",
    lead: "Use AI where it helps, then let Stricture validate service boundaries, contracts, and architecture invariants before release.",
    visualTitle: "Velocity with reliable boundaries",
    visualBody: "Developers keep delivery speed while CI blocks only the changes that create real downstream risk."
  }
];

const specLinks = {
  charter: "https://github.com/brennhill/stricture/blob/main/SPEC-CHARTER.md",
  draft: "https://github.com/brennhill/stricture/blob/main/spec/0.1-draft.md",
  licenses: "https://github.com/brennhill/stricture/blob/main/LICENSES.md",
  repo: "https://github.com/brennhill/stricture"
};
---

<MainLayout
  title="Stricture | Lineage-Aware API Linting"
  description="Stricture detects API contract drift with field-level lineage, shows cause and downstream impact, and blocks risky deploys before incidents."
>
  <section class="hero" data-hero-slides={JSON.stringify(heroSlides)}>
    <div class="hero-copy">
      <p class="kicker">Stricture</p>
      <h1 class="hero-rotator">
        <span class="hero-rotate-text" aria-live="polite">{heroSlides[0].title}</span>
      </h1>
      <p class="lead hero-lead">
        <span class="hero-rotate-text" aria-live="polite">{heroSlides[0].lead}</span>
      </p>
      <div class="hero-actions">
        <a class="button button-primary" href="/demo">Open Interactive Demo</a>
        <a class="button button-secondary" href="/open-standard">Read Open Standard</a>
      </div>
      <p class="hero-link">
        <a href="https://github.com/brennhill/stricture">View GitHub</a>
      </p>
      <div class="hero-indicators">
        <button class="hero-nav hero-prev" type="button" aria-label="Previous slide" data-hero-prev>
          ←
        </button>
        <div class="hero-dots" role="tablist" aria-label="Hero slides">
          {heroSlides.map((_, idx) => (
            <button
              type="button"
              class={`hero-indicator ${idx === 0 ? "is-active" : ""}`}
              data-hero-indicator
              data-hero-index={idx}
              aria-label={`Go to slide ${idx + 1}`}
              aria-selected={idx === 0 ? "true" : "false"}
              role="tab"
            ></button>
          ))}
        </div>
        <button class="hero-nav hero-next" type="button" aria-label="Next slide" data-hero-next>
          →
        </button>
      </div>
      <p class="hero-hint">Use arrows or dots to explore 4 scenarios.</p>
    </div>
    <aside class="hero-visual">
      <p class="kicker">Live scenario</p>
      <h2 class="hero-visual-title" data-hero-visual-title>{heroSlides[0].visualTitle}</h2>
      <p class="hero-visual-body" data-hero-visual-body>{heroSlides[0].visualBody}</p>
    </aside>
  </section>

  <section class="card getting-started-blurb">
    <div>
      <p class="kicker">Getting Started</p>
      <h2>Start using Stricture annotations today.</h2>
      <p class="lead">
        Reuse what you already have—OpenAPI, AsyncAPI, protobuf/buf, or event schemas—and layer Stricture annotations on top to get actionable findings and policy gates. Clear owners, contracts, types, and ranges make the UI and CLI instantly readable.
      </p>
      <div class="hero-actions">
        <a class="button button-primary" href="/getting-started">Read the Quickstart</a>
        <a class="button button-secondary" href="/annotations">Annotation Guide + Index</a>
      </div>
      <p class="hero-link">
        <a href="/annotation-quality">Annotation Quality Guide</a>
      </p>
    </div>
  </section>

  <section id="features" class="feature-stack">
    <header class="feature-intro card">
      <p class="kicker">Core Capabilities</p>
      <h2>Critical capabilities that protect multi-system delivery.</h2>
      <p class="lead">
        These are the features that keep high-velocity, multi-repo delivery safe when contracts and dependencies are changing constantly.
      </p>
    </header>

    <div class="panel-grid">
      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-lineage" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M5 6h4v4H5zM15 4h4v4h-4zM15 14h4v4h-4zM9 8h6M12 8v6M9 16h6" />
            </svg>
          </span>
          <h2>Field-Level Lineage</h2>
        </div>
        <p>Trace each output field to one or multiple source systems with enrichment notes.</p>
      </article>

      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-drift" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M4 6h16M4 12h10M4 18h6M16 11l3 3-3 3M14 14h8" />
            </svg>
          </span>
          <h2>Multi-Repo Drift Detection</h2>
        </div>
        <p>Catch schema, version, enum, and provider drift across repositories before deploy.</p>
      </article>

      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-overlay" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M12 3 4 7l8 4 8-4-8-4Zm-8 8 8 4 8-4M4 15l8 4 8-4" />
            </svg>
          </span>
          <h2>Standards Overlays</h2>
        </div>
        <p>Reuse one annotation set across OpenAPI, OpenTelemetry, OpenLineage, and AsyncAPI profiles.</p>
      </article>

      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-version" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M12 6v6l4 2M12 3a9 9 0 1 1-9 9M17 4h4v4" />
            </svg>
          </span>
          <h2>Source Version + As-Of Checks</h2>
        </div>
        <p>Track internal and external source-system versions and freshness dates to prevent silent breakage.</p>
      </article>

      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-policy" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M12 3 5 6v6c0 5 3.5 8 7 9 3.5-1 7-4 7-9V6l-7-3Zm0 6v5M12 17h.01" />
            </svg>
          </span>
          <h2>Warn, Block, Override</h2>
        </div>
        <p>Move from warning mode to strict release blocks with flow-tier criticality and time-bounded overrides.</p>
      </article>

      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-escalation" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M4 6h6v4H4zM14 6h6v4h-6zM9 16h6v4H9zM10 8h4M12 10v6" />
            </svg>
          </span>
          <h2>Escalation Chains</h2>
        </div>
        <p>When data quality fails, Stricture tells responders who to call in upstream order.</p>
      </article>

      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-invariants" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M6 7h12M6 12h12M6 17h8M16 15l2 2 4-4" />
            </svg>
          </span>
          <h2>Architecture Invariants</h2>
        </div>
        <p>Encode non-negotiable system rules and enforce them in CI as warn/block release gates.</p>
      </article>

      <article class="panel">
        <div class="panel-head">
          <span class="panel-icon icon-reporting" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M6 3h9l3 3v15H6zM15 3v3h3M9 12h6M9 16h6M9 8h3" />
            </svg>
          </span>
          <h2>Machine-Readable Outputs</h2>
        </div>
        <p>Export results for CI and governance workflows (including SARIF and JUnit style reporting).</p>
      </article>
    </div>
  </section>

  <section id="workflow" class="workflow">
    <h2>How It Works</h2>
    <ol>
      <li>Ingest service topology and field annotations from source repos and APIs.</li>
      <li>
        Work seamlessly with
        <a href="/when-to-use-stricture/opentelemetry"> OpenTelemetry</a>,
        <a href="/when-to-use-stricture/openapi"> OpenAPI</a>,
        <a href="/when-to-use-stricture/openlineage"> OpenLineage</a>,
        <a href="/when-to-use-stricture/asyncapi"> AsyncAPI</a>,
        <a href="/when-to-use-stricture/buf-protobuf"> Buf/Protobuf</a>, and
        <a href="/when-to-use-stricture/spectral"> Spectral</a> via overlays, so teams avoid redundant metadata work.
      </li>
      <li>Export lineage artifacts and compare against a baseline release snapshot.</li>
      <li>Classify drift by severity, impacted flows, and enforce policy in warn or block mode.</li>
      <li>Attach ownership and escalation routes directly to affected fields.</li>
      <li>Evaluate architecture invariants such as dependency direction and provenance completeness.</li>
    </ol>
  </section>

  <section id="separation-of-concerns" class="card compare-section">
    <p class="kicker">Separation Of Concerns</p>
    <h2>Open standard semantics, reference engine execution.</h2>
    <p>
      Stricture keeps the interoperability contract independent from the runtime engine:
      teams can adopt the SOS model across tools while using the AGPL CLI as a reference implementation.
    </p>
    <div class="compare-grid">
      <article class="compare-card">
        <h3>Stricture Open Standard (CC BY 4.0)</h3>
        <p>
          Defines field lineage, drift classes, architecture invariants, and profile overlay semantics
          as a portable contract that is implementation-neutral.
        </p>
        <div class="hero-actions">
          <a class="button button-secondary" href={specLinks.charter} target="_blank" rel="noopener noreferrer">Read Charter</a>
          <a class="button button-secondary" href={specLinks.draft} target="_blank" rel="noopener noreferrer">Read v0.1 Draft</a>
        </div>
      </article>
      <article class="compare-card">
        <h3>Reference Implementation (AGPL-3.0)</h3>
        <p>
          The `stricture` CLI executes linting, lineage export/diff, policy gates, and escalation checks
          against the SOS semantics, with independent implementation paths possible.
        </p>
        <div class="hero-actions">
          <a class="button button-secondary" href={specLinks.repo} target="_blank" rel="noopener noreferrer">View Implementation</a>
          <a class="button button-secondary" href={specLinks.licenses} target="_blank" rel="noopener noreferrer">License Split</a>
        </div>
      </article>
    </div>
  </section>

  <section class="cta">
    <h2>Run the full lifecycle simulation and invariant checks.</h2>
    <p>
      The demo shows 14 connected systems across logistics, fintech, media,
      ecommerce, and governance with real-time mutation, rerun, and architecture invariant enforcement.
    </p>
    <div class="hero-actions">
      <a class="button button-primary" href="/demo">Launch Demo</a>
      <a class="button button-secondary" href="/architecture-invariants">Read Invariants Guide</a>
    </div>
  </section>

  <script type="module">
    const hero = document.querySelector(".hero");
    if (hero instanceof HTMLElement) {
      const rotator = hero.querySelector(".hero-rotator");
      const titleText = hero.querySelector(".hero-rotator .hero-rotate-text");
      const leadText = hero.querySelector(".hero-lead .hero-rotate-text");
      const visualTitle = hero.querySelector("[data-hero-visual-title]");
      const visualBody = hero.querySelector("[data-hero-visual-body]");
      const indicators = Array.from(hero.querySelectorAll("[data-hero-indicator]"));
      const prevButton = hero.querySelector("[data-hero-prev]");
      const nextButton = hero.querySelector("[data-hero-next]");
      const rawSlides = hero.getAttribute("data-hero-slides");

      let slides = [];
      try {
        slides = rawSlides ? JSON.parse(rawSlides) : [];
      } catch {
        slides = [];
      }

      if (rotator && titleText && leadText && visualTitle && visualBody && slides.length > 1) {
        const reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
        const intervalMs = reduceMotion ? 26000 : 18000;
        let idx = 0;

        const applySlide = (nextIdx) => {
          const next = slides[nextIdx];
          if (!next) return;
          titleText.textContent = next.title || "";
          leadText.textContent = next.lead || "";
          visualTitle.textContent = next.visualTitle || "";
          visualBody.textContent = next.visualBody || "";
          indicators.forEach((indicator, indicatorIdx) => {
            indicator.classList.toggle("is-active", indicatorIdx === nextIdx);
            indicator.setAttribute("aria-selected", indicatorIdx === nextIdx ? "true" : "false");
          });
        };

        const goTo = (nextIdx) => {
          idx = (nextIdx + slides.length) % slides.length;
          if (reduceMotion) {
            applySlide(idx);
            return;
          }
          rotator.classList.add("hero-rotating-out");
          window.setTimeout(() => {
            applySlide(idx);
            rotator.classList.remove("hero-rotating-out");
          }, 180);
        };

        window.setInterval(() => {
          goTo(idx + 1);
        }, intervalMs);

        indicators.forEach((indicator) => {
          indicator.addEventListener("click", () => {
            const targetIdx = Number(indicator.getAttribute("data-hero-index"));
            if (Number.isNaN(targetIdx)) return;
            goTo(targetIdx);
          });
        });

        prevButton?.addEventListener("click", () => goTo(idx - 1));
        nextButton?.addEventListener("click", () => goTo(idx + 1));
      }
    }
  </script>
</MainLayout>
