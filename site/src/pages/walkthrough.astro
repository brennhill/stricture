---
import MainLayout from "../layouts/MainLayout.astro";
import walkthroughScript from "../scripts/walkthrough-app.js?url";

export const prerender = true;
---

<MainLayout title="Stricture Walkthrough | Notation and Drift Lifecycle">
  <section class="walkthrough-shell">
    <header class="walkthrough-header">
      <div>
        <p class="kicker">Interactive Walkthrough</p>
        <h1>See One Field Across Spec, Source, Lineage, and Drift Gates.</h1>
        <p class="lead">
          This guided lab shows how Stricture annotations map to OpenAPI-like contracts,
          profile aliases, drift findings, and escalation chains.
        </p>
      </div>
      <div id="walkthrough-gate" class="gate-banner gate-ok">Baseline ready</div>
    </header>

    <section class="walkthrough-toolbar card">
      <label>
        Scenario
        <select id="wt-scenario">
          <option value="logistics">Logistics ETA Projection (logistics)</option>
        </select>
      </label>
      <label>
        Profile
        <select id="wt-profile">
          <option value="stricture">stricture</option>
          <option value="openlineage">openlineage</option>
          <option value="otel">otel</option>
          <option value="openapi">openapi</option>
          <option value="asyncapi">asyncapi</option>
        </select>
      </label>
      <label class="checkbox-label">
        <input id="wt-aliases" type="checkbox" />
        Show Aliases
      </label>
      <label class="checkbox-label">
        <input id="wt-changed-only" type="checkbox" />
        Changed Only
      </label>
      <div class="walkthrough-actions">
        <button id="wt-prev" class="button button-secondary">Previous</button>
        <button id="wt-next" class="button button-secondary">Next</button>
        <button id="wt-autoplay" class="button button-primary">Auto Play</button>
        <button id="wt-copy-link" class="button button-secondary">Copy Share Link</button>
      </div>
    </section>

    <p id="wt-runtime-status" class="walkthrough-status walkthrough-status-loading">
      Loading walkthrough data...
    </p>

    <section class="walkthrough-rail card">
      <h2>Lifecycle Steps</h2>
      <div id="wt-steps" class="step-list">
        <button class="step-pill step-pill-active" aria-current="step">1. Baseline Contract</button>
      </div>
      <p id="wt-step-description" class="muted">Preparing walkthrough lifecycle...</p>
    </section>

    <section class="walkthrough-grid">
      <article class="card walkthrough-pane">
        <header class="pane-header">
          <h2>Pane A: API Contract</h2>
          <span id="wt-pane-a-status" class="pane-tag">OpenAPI</span>
        </header>
        <pre id="wt-contract" class="code-view">Loading contract view...</pre>
      </article>

      <article class="card walkthrough-pane">
        <header class="pane-header">
          <h2>Pane B: Source Annotation</h2>
          <span id="wt-pane-b-status" class="pane-tag">stricture-source</span>
        </header>
        <pre id="wt-source" class="code-view">Loading source annotation view...</pre>
      </article>

      <article class="card walkthrough-pane">
        <header class="pane-header">
          <h2>Pane C: Lineage Graph</h2>
          <span class="pane-tag">Runtime Shape</span>
        </header>
        <div id="wt-graph" class="walkthrough-graph">
          <article class="node node-ok">
            <h3>Loading...</h3>
            <p>owner=initializing</p>
            <span class="node-badge">INIT</span>
          </article>
        </div>
        <div id="wt-edges" class="edge-list">
          <article class="edge edge-healthy">Loading edges...</article>
        </div>
      </article>

      <article class="card walkthrough-pane">
        <header class="pane-header">
          <h2>Pane D: Findings + Escalation</h2>
          <span id="wt-pane-d-status" class="pane-tag">Gate</span>
        </header>
        <div id="wt-summary" class="summary-grid">
          <article class="summary-item"><h3>Gate</h3><p>INIT</p></article>
          <article class="summary-item"><h3>Findings</h3><p>0</p></article>
          <article class="summary-item"><h3>High</h3><p>0</p></article>
          <article class="summary-item"><h3>Changed</h3><p>0</p></article>
        </div>
        <div id="wt-findings" class="list">
          <article class="list-item">Preparing findings...</article>
        </div>
        <div id="wt-escalation" class="list">
          <article class="list-item">Preparing escalation chain...</article>
        </div>
      </article>
    </section>
  </section>

  <script type="module" src={walkthroughScript}></script>
</MainLayout>
