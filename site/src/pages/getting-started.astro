---
import MainLayout from "../layouts/MainLayout.astro";

const inlineAnnotationSnippet = "// strict-source: Identity\nUserID int `json:\"user_id\"`";
---

<MainLayout title="Getting Started | Stricture" description="Learn how to set up Stricture, author clear annotations, and tune policy/override settings for safe releases.">
  <section class="card">
    <p class="kicker">Start Here</p>
    <h1>Getting Started with Stricture</h1>
    <p class="lead">Three steps: create a sidecar file, annotate fields, run Stricture. Keep source comments minimal; let defaults and tooling compute the rest.</p>
  </section>

  <section class="card">
    <h2>1) Create a sidecar file (one-time)</h2>
    <p>Create <code>strict-lineage.yml</code> at your project root:</p>
    <pre><code>{`# strict-lineage.yml
service: my-service
version: v1.0.0

upstream:
  Identity:
    contract: git+https://github.com/acme/identity//openapi.yaml
    scope: cross_repo`}</code></pre>
    <p>This declares your upstream services and their contracts. Or generate it automatically:</p>
    <pre><code>strict helper init-lineage .</code></pre>
  </section>

  <section class="card">
    <h2>2) Annotate fields</h2>
    <p>Add a comment above each struct field that comes from an upstream service:</p>
    <pre><code>{inlineAnnotationSnippet}</code></pre>
    <p>That's it. Two words after the prefix. Everything else is inferred from the sidecar file.</p>
    <ul>
      <li><strong>Only required field</strong>: <code>from</code> (the upstream service name).</li>
      <li><strong>Optional qualifiers</strong>: <code>scope</code>, <code>provider</code>, <code>transform</code>, <code>merge</code>, <code>classification</code>, <code>break_policy</code>, <code>note</code>.</li>
      <li><strong>Auto-inferred</strong>: field path, source version, contract, owner, escalation, and 12 more fields.</li>
    </ul>
    <p>See the <a href="/annotations">Annotation Reference</a> for the complete key list, then use the <a href="/annotation-quality">Annotation Quality Guide</a> for writing tips.</p>
  </section>

  <section class="card">
    <h2>3) Set policy and run</h2>
    <ul>
      <li><strong>Policy URL</strong>: set <code>stricture_policy_url</code> in <code>.stricture.yml</code> (optional).</li>
      <li><strong>Validate</strong>: <code>strict helper validate --strict .</code></li>
      <li><strong>Export + diff</strong>: <code>strict lineage-export</code> and <code>strict lineage-diff</code> for CI drift checks.</li>
      <li><strong>Overrides</strong>: time-bound, ticketed, field + change-type scoped for migration windows.</li>
    </ul>
    <p>CI example:</p>
    <pre><code>{`- name: Validate lineage
  run: strict helper validate --strict .

- name: Check drift
  run: |
    strict lineage-export --out lineage/current.json .
    strict lineage-diff \\
      --base lineage/baseline.json \\
      --head lineage/current.json \\
      --fail-on medium`}</code></pre>
  </section>

  <section class="card">
    <h2>Designing clear findings</h2>
    <p>Findings inherit your annotation clarity. Include:</p>
    <ul>
      <li>Impact: who/what breaks downstream if this changes.</li>
      <li>Upstream/downstream chain: source â†’ consumers.</li>
      <li>Next action: code fix, contract bump, override with expiry.</li>
    </ul>
  </section>
</MainLayout>
